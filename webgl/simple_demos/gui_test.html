<html>
<head>
<meta charset="utf-8">
<title>simpleDemo</title>
<script type="text/javascript" src="../../wgeCore.js"></script>
<script type="text/javascript" src="../../wgeMatrix.js"></script>
<script type="text/javascript" src="../wgeSprite.js"></script>
<script type="text/javascript" src="../../wgeGUI.js"></script>
<script type="text/javascript" src="../wgeWebGL.js"></script>

</head>

<body>

<script type="text/javascript">
"use strict";
var MySprite = WGE.Class(WGE.Sprite2d,
{
	dx : 0,
	dy : 0,
	drz : 0,
	dry : 0,

	randomize : function()
	{
		this.dx = Math.random() * 0.5 + 0.01;
		this.dy = Math.random() * 0.5 + 0.01;
		this.drz = Math.random() * 0.005 + 0.001;
		var x = Math.random();
		this.dry = x > 0.5 ? Math.random() * 0.005 + 0.001 : 0;
	},

	update : function(dt, boundingX, boundingY)
	{
		var d = this.pos.data;
		d[0] += this.dx * dt;
		d[1] += this.dy * dt;
		this.rotateZ(this.drz * dt);
		if(this.dry)
			this.rotateY(this.dry * dt);

		if(d[0] < 0)
		{
			d[0] = 0;
			this.dx = -this.dx;
		}
		else if(d[0] > boundingX)
		{
			d[0] = boundingX;
			this.dx = -this.dx;
		}

		if(d[1] < 0)
		{
			d[1] = 0;
			this.dy = -this.dy;
		}
		else if(d[1] > boundingY)
		{
			d[1] = boundingY;
			this.dy = -this.dy;
		}

	}

});

var MyGUI = WGE.Class(WGE.GUIInterface, 
{
	context : undefined,
	x : 0,
	y : 0,
	isMouseDown : false,
	sprites : null,

	bindFather : function(fatherObj)
	{
		if(WGE.GUIInterface.bindFather.call(this, fatherObj));
		{
			var context = this.canvas.getContext('experimental-webgl');		
			this.context = context;
			context.enable(context.BLEND);
			context.blendFunc(context.ONE, context.ONE);
			return !!this.context;
		}
		return false;
	},

	initSprites : function()
	{
		var sprites = [];
		this.sprites = sprites;
		for(var i = 0; i != 14; ++i)
		{
			var img = WGE.ID('test' + i);
			sprites[i] = new MySprite(this.canvas, this.context);
			sprites[i].initSprite(img);
			sprites[i].setAlpha(0.5 + Math.random() * 0.5);
			sprites[i].randomize();
		}
		this.context.clearColor(0.0, 0.0, 0.0, 1.0);
	},

	update : function(dt)
	{
		var w = this.canvas.width, h = this.canvas.height;
		var sprites = this.sprites;
		for(var i in sprites)
		{
			sprites[i].update(dt, w, h);
		}
	},

	render : function()
	{
		this.context.clear(this.context.COLOR_BUFFER_BIT);
		var sprites = this.sprites;
		for(var i in sprites)
		{
			sprites[i].render();
		}
	},

	mouseDownEvent : function(e, x, y)
	{
		this.isMouseDown = true;
		this.x = x;
		this.y = y;
	},

	mouseUpEvent : function()
	{
		this.isMouseDown = false;
	},

	mouseMoveEvent : function(e, x, y)
	{
		if(this.isMouseDown)
		{
			this.x = x;
			this.y = y;
		}
	},

	resizeEvent : function()
	{
		if(this.context)
		{
			this.context.viewport(0, 0, this.canvas.width, this.canvas.height);
			var sprites = this.sprites;
			for(var i in sprites)
			{
				sprites[i].onCanvasResize();
			}
		}
	}
});

var div = WGE.CE('div');
document.body.appendChild(div);
div.setAttribute('style', "width: 100%; height:100%;");
var gui = new MyGUI(div);
document.body.setAttribute("onresize", "gui.onresize(event);");

document.body.setAttribute("onload", "gui.initSprites();gui.start();");

</script>

<div style="display:none">
<img src="../../res/png/0.png" id="test0">
<img src="../../res/png/1.png" id="test1">
<img src="../../res/png/2.png" id="test2">
<img src="../../res/png/3.png" id="test3">
<img src="../../res/png/4.png" id="test4">
<img src="../../res/png/5.png" id="test5">
<img src="../../res/png/6.png" id="test6">
<img src="../../res/png/7.png" id="test7">
<img src="../../res/png/8.png" id="test8">
<img src="../../res/png/9.png" id="test9">
<img src="../../res/png/10.png" id="test10">
<img src="../../res/png/11.png" id="test11">
<img src="../../res/png/12.png" id="test12">
<img src="../../res/png/13.png" id="test13">
</div>
</body>
</html>
